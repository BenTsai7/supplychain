var express = require('express');
var path = require('path');
var router = express.Router();
var http = require("http");
var exec = require('child_process').exec;
const ethereumjs = require('ethereumjs-util');
var ip = "192.168.107.136";
var port = "5002";
var supplychain_address = "0xd6ad415f6f9d59ad494193d530ad5411f33ff9f9";

function http_post(ip, port, url, params, body, callback) {
	var options = {
		host: ip,
		port: port,
		path: url + "?" + params,
		method: "POST",
		headers: {
			"Content-Type": "application/json",
			"Content-Length": body.length
		}
	};
	var req = http.request(options, function(incoming_msg) {
		console.log("respones status " + incoming_msg.statusCode);
		var fulldata = '';
		incoming_msg.on("data", function(data) {
				fulldata+=data;
		});
		incoming_msg.on("end", function() {
				if (incoming_msg.statusCode === 200) {
				callback(true, fulldata);
				}
				else{
					callback(false,fulldata);
				}
		});
	});
	req.write(body);
	req.end();
}

router.get('/info', function(req, res, next) {
  if(!req.session.username){
  	res.send(301);
  }
  //var comStr = 'curl -l -H "Content-type: application/json" -X POST -d ' + '\'' +({"token":"29005b674967f413ebf20e5686e4d147","user_id":"54"}) +'\' '+ 'http://youle.maiugame.com/sdk.php/LoginNotify/login_verify';
  var baseUrl = "http://"+ip+":"+port;
  var comStr = "curl \"" + baseUrl +"/WeBASE-Front/1/web3/blockNumber\"";
  var blockNumber,txNumber,pendingTxNumber,NodeNumber;
  exec(comStr, function(err,stdout,stderr){
    if(err) {
        res.send(500);
    } else {
    	blockNumber = stdout.toString();
    	comStr = "curl \"" + baseUrl +"/WeBASE-Front/1/web3/transaction-total\"";
  		exec(comStr, function(err,stdout,stderr){
    	if(err) {
        	res.send(500);
    	} else {
        txNumber = JSON.parse(stdout)['txSum'].toString();
        comStr = "curl \"" + baseUrl +"/WeBASE-Front/1/web3/pending-transactions-count\"";
  		exec(comStr, function(err,stdout,stderr){
    	if(err) {
        	res.send(500);
    	} else {
        	pendingTxNumber = stdout.toString();
        	comStr = "curl \""+baseUrl +"/WeBASE-Front/1/web3/sealerList\"";
  			exec(comStr, function(err,stdout,stderr){
    		if(err) {
        		res.send(500);
    		} else {
        		NodeNumber = JSON.parse(stdout).length.toString();
        		var obj = {"blockNumber":blockNumber,"txNumber":txNumber,"pendingTxNumber":pendingTxNumber,"NodeNumber":NodeNumber};
  				res.send(obj);
    		}
			});
    		};
		});
    	}
	});
    }
  });
});

router.post('/txCreate',function(req,res,next){
	if(!req.session.username){
  	res.send(301);
  }
	var params = {
    "useAes":false,
    "user":req.session.address,
    "contractName":"SupplyChain",
    "contractAddress":supplychain_address,
    "funcName":"createPurchasingTx",
    "funcParam":[req.session.username,req.body.txhash,req.body.duetime,req.body.amount,req.body.commodity,req.body.info,1,"0x1","0x1"],
    "groupId" :"1"
	};
	http_post(ip, port, "/WeBASE-Front/trans/handle", "", JSON.stringify(params), function(is_ok, data) {
		console.log(data.toString());
	if (is_ok) {
		address = JSON.parse(data)["output"];
		//去除前导0
		var legal_address;
		legal_address = address.substr(0,2)+address.substr(address.length-40,40);
		params = {
    		"contractBin":'60806040523480156200001157600080fd5b5060405162002a0c38038062002a0c83398101806040528101908080519060200190929190805190602001909291908051906020019092919080519060200190929190805190602001909291908051906020019092919080519060200190929190805182019291906020018051906020019092919080518201929190602001805190602001909291908051906020019092919080519060200190929190505050336000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508c6002811115620000fe57fe5b600060146101000a81548160ff021916908360028111156200011c57fe5b02179055508b600160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550426003819055508a60048190555089600560006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555088600660006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555087600881905550876009819055506000600a60006101000a81548160ff021916908360038111156200022057fe5b021790555086600b816000191690555085600c908051906020019062000248929190620002c8565b5084600d8190555083600e908051906020019062000268929190620002c8565b5082600f60146101000a81548160ff021916908360ff160217905550816010816000191690555080601181600019169055506000601860006101000a81548160ff0219169083151502179055505050505050505050505050505062000377565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106200030b57805160ff19168380011785556200033c565b828001600101855582156200033c579182015b828111156200033b5782518255916020019190600101906200031e565b5b5090506200034b91906200034f565b5090565b6200037491905b808211156200037057600081600090555060010162000356565b5090565b90565b61268580620003876000396000f3006080604052600436106100d0576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff16806304da3f19146100d557806317bd3ed6146101695780635e878508146101945780636d01875d146102d95780637e78fdb9146103045780638a4e37691461035b5780639c14c09514610499578063c1a0b0fc146105af578063c6bf57651461060a578063c7eaf9b414610720578063dfbfd9151461086d578063e857fa6c146108b2578063f5055e061461091e578063f5434eed14610983575b600080fd5b3480156100e157600080fd5b506100ea610a61565b604051808915151515815260200188600019166000191681526020018760ff1660ff168152602001866000191660001916815260200185600019166000191681526020018460ff1660ff168152602001836000191660001916815260200182600019166000191681526020019850505050505050505060405180910390f35b34801561017557600080fd5b5061017e610ac6565b6040518082815260200191505060405180910390f35b3480156101a057600080fd5b506101a9610ad0565b60405180866000191660001916815260200180602001858152602001806020018473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001838103835287818151815260200191508051906020019080838360005b83811015610233578082015181840152602081019050610218565b50505050905090810190601f1680156102605780820380516001836020036101000a031916815260200191505b50838103825285818151815260200191508051906020019080838360005b8381101561029957808201518184015260208101905061027e565b50505050905090810190601f1680156102c65780820380516001836020036101000a031916815260200191505b5097505050505050505060405180910390f35b3480156102e557600080fd5b506102ee610c50565b6040518082815260200191505060405180910390f35b34801561031057600080fd5b50610319610c5a565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b34801561036757600080fd5b50610370610c84565b604051808d73ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018c60ff1660ff1681526020018b600019166000191681526020018a600019166000191681526020018973ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018860ff1660ff168152602001876000191660001916815260200186600019166000191681526020018573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018460ff1660ff168152602001836000191660001916815260200182600019166000191681526020019c5050505050505050505050505060405180910390f35b3480156104a557600080fd5b50610529600480360381019080803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509192919290803560ff16906020019092919080356000191690602001909291908035600019169060200190929190505050610d67565b604051808315151515815260200180602001828103825283818151815260200191508051906020019080838360005b83811015610573578082015181840152602081019050610558565b50505050905090810190601f1680156105a05780820380516001836020036101000a031916815260200191505b50935050505060405180910390f35b3480156105bb57600080fd5b506105f0600480360381019080803573ffffffffffffffffffffffffffffffffffffffff1690602001909291905050506111a0565b604051808215151515815260200191505060405180910390f35b34801561061657600080fd5b5061069a600480360381019080803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509192919290803560ff16906020019092919080356000191690602001909291908035600019169060200190929190505050611271565b604051808315151515815260200180602001828103825283818151815260200191508051906020019080838360005b838110156106e45780820151818401526020810190506106c9565b50505050905090810190601f1680156107115780820380516001836020036101000a031916815260200191505b50935050505060405180910390f35b34801561072c57600080fd5b5061073561147b565b604051808c73ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018b81526020018a73ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018973ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018881526020018781526020018673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018481526020018381526020018281526020019b50505050505050505050505060405180910390f35b34801561087957600080fd5b506108986004803603810190808035906020019092919050505061159f565b604051808215151515815260200191505060405180910390f35b3480156108be57600080fd5b506108c76116d0565b6040518080602001828103825283818151815260200191508051906020019060200280838360005b8381101561090a5780820151818401526020810190506108ef565b505050509050019250505060405180910390f35b34801561092a57600080fd5b50610969600480360381019080803573ffffffffffffffffffffffffffffffffffffffff1690602001909291908035906020019092919050505061175e565b604051808215151515815260200191505060405180910390f35b34801561098f57600080fd5b506109db600480360381019080803560ff16906020019092919080356000191690602001909291908035600019169060200190929190803560001916906020019092919050505061188a565b604051808315151515815260200180602001828103825283818151815260200191508051906020019080838360005b83811015610a25578082015181840152602081019050610a0a565b50505050905090810190601f168015610a525780820380516001836020036101000a031916815260200191505b50935050505060405180910390f35b600080600080600080600080601860009054906101000a900460ff16601954601a60009054906101000a900460ff16601b54601c54601d60009054906101000a900460ff16601e54601f54975097509750975097509750975097509091929394959697565b6000600454905090565b60006060600060606000600b54600c600d54600e600f60009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16838054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015610b9c5780601f10610b7157610100808354040283529160200191610b9c565b820191906000526020600020905b815481529060010190602001808311610b7f57829003601f168201915b50505050509350818054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015610c385780601f10610c0d57610100808354040283529160200191610c38565b820191906000526020600020905b815481529060010190602001808311610c1b57829003601f168201915b50505050509150945094509450945094509091929394565b6000600954905090565b6000600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16905090565b600080600080600080600080600080600080600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16600f60149054906101000a900460ff16601054601154600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16601260009054906101000a900460ff16601354601454600f60009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16601560009054906101000a900460ff166016546017549b509b509b509b509b509b509b509b509b509b509b509b50909192939495969798999a9b565b6000606060001515610d798733611cb3565b15151415610dc25760006040805190810160405280600e81526020017f696c6c6567616c2061636365737300000000000000000000000000000000000081525091509150611197565b600380811115610dce57fe5b610dd7876121ff565b6003811115610de257fe5b6003811115610ded57fe5b141515610e355760006040805190810160405280601881526020017f6e6f742063657274696679696e6720617574686f72697479000000000000000081525091509150611197565b60006003811115610e4257fe5b600a60009054906101000a900460ff166003811115610e5d57fe5b1415610ea45760006040805190810160405280601881526020017f7472616e73616374696f6e206e6f74206163637065746564000000000000000081525091509150611197565b60016003811115610eb157fe5b600a60009054906101000a900460ff166003811115610ecc57fe5b141515610f145760006040805190810160405280602081526020017f7472616e73616374696f6e20697320616c726561647920636f6e6669726d656481525091509150611197565b33600f60006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555084601560006101000a81548160ff021916908360ff160217905550836016816000191690555082601781600019169055506002600a60006101000a81548160ff02191690836003811115610fa557fe5b021790555060016002811115610fb757fe5b600060149054906101000a900460ff166002811115610fd257fe5b14801561101857506000600660009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1614155b156110f757600660009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663dfbfd9156009546040518263ffffffff167c010000000000000000000000000000000000000000000000000000000002815260040180828152602001915050602060405180830381600087803b1580156110b057600080fd5b505af11580156110c4573d6000803e3d6000fd5b505050506040513d60208110156110da57600080fd5b810190808051906020019092919050505015156110f657600080fd5b5b7f71dc038f05603e1a224e16013aa1eee13aaac7365b1430820e4648c833aa33d133604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390a160016040805190810160405280601581526020017f7472616e73616374696f6e20636f6e6669726d65640000000000000000000000815250915091505b94509492505050565b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16141515611201576000905061126c565b60078290806001815401808255809150509060018203906000526020600020016000909192909190916101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555050600190505b919050565b60006060600015156112838733611cb3565b151514156112cc5760006040805190810160405280600e81526020017f696c6c6567616c2061636365737300000000000000000000000000000000000081525091509150611472565b600060038111156112d957fe5b600a60009054906101000a900460ff1660038111156112f457fe5b14151561133c5760006040805190810160405280601d81526020017f7472616e73616374696f6e20686173206265656e20616363706574656400000081525091509150611472565b33600260006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555084601260006101000a81548160ff021916908360ff160217905550836013816000191690555082601481600019169055506001600a60006101000a81548160ff021916908360038111156113cd57fe5b02179055507f3046a5cb3c999f24e9da92265b1aa10e877e91dfacc1ad40b142e9ecf3e4de8e33604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390a160016040805190810160405280601481526020017f7472616e73616374696f6e206163636570746564000000000000000000000000815250915091505b94509492505050565b60008060008060008060008060008060008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16600060149054906101000a900460ff1660028111156114c957fe5b600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16600354600454600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16600660009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16600854600954600a60009054906101000a900460ff16600381111561157c57fe5b9a509a509a509a509a509a509a509a509a509a509a50909192939495969798999a565b600080600090505b6007805490508110156116c5573373ffffffffffffffffffffffffffffffffffffffff166007828154811015156115da57fe5b9060005260206000200160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1614156116b85782600954101561163457600091506116ca565b826009600082825403925050819055507f64cea6b2311dae2ee8a78ce0dd270260dd650a1ac7eed0ced28722625ec424f78333604051808381526020018273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019250505060405180910390a1600191506116ca565b80806001019150506115a7565b600091505b50919050565b6060600780548060200260200160405190810160405280929190818152602001828054801561175457602002820191906000526020600020905b8160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001906001019080831161170a575b5050505050905090565b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161415156117bf5760009050611884565b600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff1614151561181f5760009050611884565b6002600381111561182c57fe5b600a60009054906101000a900460ff16600381111561184757fe5b1415156118575760009050611884565b6000600d5414151561186c5760009050611884565b60095482111561187f5760009050611884565b600190505b92915050565b6000606060038081111561189a57fe5b600a60009054906101000a900460ff1660038111156118b557fe5b1415611923576000606060405190810160405280602181526020017f7472616e73616374696f6e2068617320616c7265616479206265656e2070616981526020017f640000000000000000000000000000000000000000000000000000000000000081525091509150611caa565b6002600381111561193057fe5b600a60009054906101000a900460ff16600381111561194b57fe5b1415156119ba576000606060405190810160405280602281526020017f7472616e73616374696f6e20686173206e6f74206265656e20636f6e6669726d81526020017f656400000000000000000000000000000000000000000000000000000000000081525091509150611caa565b600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161415611afe57601860009054906101000a900460ff1615611a665760006040805190810160405280600c81526020017f616c72656164792070616964000000000000000000000000000000000000000081525091509150611caa565b6001601860006101000a81548160ff02191690831515021790555085601a60006101000a81548160ff021916908360ff16021790555084601b816000191690555083601c8160001916905550826019816000191690555060016040805190810160405280601481526020017f7761697420746f20626520636f6e6669726d656400000000000000000000000081525091509150611caa565b600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161415611c6d57601860009054906101000a900460ff161515611bab5760006040805190810160405280601481526020017f646562746f7220686173206e6f7420706169642e00000000000000000000000081525091509150611caa565b85601d60006101000a81548160ff021916908360ff16021790555084601e816000191690555083601f81600019169055506003600a60006101000a81548160ff02191690836003811115611bfb57fe5b02179055507feff32cd8ccb03fd86051fe0cc2d91fe87eb44db13680778658a04f502d63e69460405160405180910390a160016040805190810160405280601a81526020017f7472616e73616374696f6e207061696420636f6e6669726d656400000000000081525091509150611caa565b60006040805190810160405280600e81526020017f696c6c6567616c20616363657373000000000000000000000000000000000000815250915091505b94509492505050565b60008060008061100192508273ffffffffffffffffffffffffffffffffffffffff1663f23f63c96040518163ffffffff167c01000000000000000000000000000000000000000000000000000000000281526004018080602001828103825260048152602001807f5573657200000000000000000000000000000000000000000000000000000000815250602001915050602060405180830381600087803b158015611d5e57600080fd5b505af1158015611d72573d6000803e3d6000fd5b505050506040513d6020811015611d8857600080fd5b810190808051906020019092919050505091508173ffffffffffffffffffffffffffffffffffffffff1663e8434e39878473ffffffffffffffffffffffffffffffffffffffff16637857d7c96040518163ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401602060405180830381600087803b158015611e1c57600080fd5b505af1158015611e30573d6000803e3d6000fd5b505050506040513d6020811015611e4657600080fd5b81019080805190602001909291905050506040518363ffffffff167c010000000000000000000000000000000000000000000000000000000002815260040180806020018373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001828103825284818151815260200191508051906020019080838360005b83811015611ef4578082015181840152602081019050611ed9565b50505050905090810190601f168015611f215780820380516001836020036101000a031916815260200191505b509350505050602060405180830381600087803b158015611f4157600080fd5b505af1158015611f55573d6000803e3d6000fd5b505050506040513d6020811015611f6b57600080fd5b8101908080519060200190929190505050905060018173ffffffffffffffffffffffffffffffffffffffff1663949d225d6040518163ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401602060405180830381600087803b158015611fe457600080fd5b505af1158015611ff8573d6000803e3d6000fd5b505050506040513d602081101561200e57600080fd5b810190808051906020019092919050505014151561202f57600093506121f6565b8473ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff1663846719e060006040518263ffffffff167c010000000000000000000000000000000000000000000000000000000002815260040180828152602001915050602060405180830381600087803b1580156120b657600080fd5b505af11580156120ca573d6000803e3d6000fd5b505050506040513d60208110156120e057600080fd5b810190808051906020019092919050505073ffffffffffffffffffffffffffffffffffffffff1663bf40fac16040518163ffffffff167c01000000000000000000000000000000000000000000000000000000000281526004018080602001828103825260078152602001807f6164647265737300000000000000000000000000000000000000000000000000815250602001915050602060405180830381600087803b15801561219057600080fd5b505af11580156121a4573d6000803e3d6000fd5b505050506040513d60208110156121ba57600080fd5b810190808051906020019092919050505073ffffffffffffffffffffffffffffffffffffffff161415156121f157600093506121f6565b600193505b50505092915050565b60008060008061100192508273ffffffffffffffffffffffffffffffffffffffff1663f23f63c96040518163ffffffff167c01000000000000000000000000000000000000000000000000000000000281526004018080602001828103825260048152602001807f5573657200000000000000000000000000000000000000000000000000000000815250602001915050602060405180830381600087803b1580156122aa57600080fd5b505af11580156122be573d6000803e3d6000fd5b505050506040513d60208110156122d457600080fd5b810190808051906020019092919050505091508173ffffffffffffffffffffffffffffffffffffffff1663e8434e39868473ffffffffffffffffffffffffffffffffffffffff16637857d7c96040518163ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401602060405180830381600087803b15801561236857600080fd5b505af115801561237c573d6000803e3d6000fd5b505050506040513d602081101561239257600080fd5b81019080805190602001909291905050506040518363ffffffff167c010000000000000000000000000000000000000000000000000000000002815260040180806020018373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001828103825284818151815260200191508051906020019080838360005b83811015612440578082015181840152602081019050612425565b50505050905090810190601f16801561246d5780820380516001836020036101000a031916815260200191505b509350505050602060405180830381600087803b15801561248d57600080fd5b505af11580156124a1573d6000803e3d6000fd5b505050506040513d60208110156124b757600080fd5b810190808051906020019092919050505090508073ffffffffffffffffffffffffffffffffffffffff1663846719e060006040518263ffffffff167c010000000000000000000000000000000000000000000000000000000002815260040180828152602001915050602060405180830381600087803b15801561253a57600080fd5b505af115801561254e573d6000803e3d6000fd5b505050506040513d602081101561256457600080fd5b810190808051906020019092919050505073ffffffffffffffffffffffffffffffffffffffff1663fda69fae6040518163ffffffff167c01000000000000000000000000000000000000000000000000000000000281526004018080602001828103825260098152602001807f757365725f747970650000000000000000000000000000000000000000000000815250602001915050602060405180830381600087803b15801561261457600080fd5b505af1158015612628573d6000803e3d6000fd5b505050506040513d602081101561263e57600080fd5b810190808051906020019092919050505093505050509190505600a165627a7a7230582023ec213c4305ca8680d10d0fc919261192607a0db337c80f40e63f6371fd6ca40029',
    		"contractName":"DebtEvidence",
    		"address":legal_address,
    		"abiInfo":[{"constant":true,"inputs":[],"name":"getPaymentInfo","outputs":[{"name":"","type":"bool"},{"name":"","type":"bytes32"},{"name":"","type":"uint8"},{"name":"","type":"bytes32"},{"name":"","type":"bytes32"},{"name":"","type":"uint8"},{"name":"","type":"bytes32"},{"name":"","type":"bytes32"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"getDueTime","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"getTxInfo","outputs":[{"name":"","type":"bytes32"},{"name":"","type":"string"},{"name":"","type":"uint256"},{"name":"","type":"string"},{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"getDebtAmount","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"getDebtor","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"getSignature","outputs":[{"name":"","type":"address"},{"name":"","type":"uint8"},{"name":"","type":"bytes32"},{"name":"","type":"bytes32"},{"name":"","type":"address"},{"name":"","type":"uint8"},{"name":"","type":"bytes32"},{"name":"","type":"bytes32"},{"name":"","type":"address"},{"name":"","type":"uint8"},{"name":"","type":"bytes32"},{"name":"","type":"bytes32"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"account","type":"string"},{"name":"_v3","type":"uint8"},{"name":"_r3","type":"bytes32"},{"name":"_s3","type":"bytes32"}],"name":"ConfirmTransaction","outputs":[{"name":"","type":"bool"},{"name":"","type":"string"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_address","type":"address"}],"name":"AddSubEvidence","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"account","type":"string"},{"name":"_v2","type":"uint8"},{"name":"_r2","type":"bytes32"},{"name":"_s2","type":"bytes32"}],"name":"AcceptTransaction","outputs":[{"name":"","type":"bool"},{"name":"","type":"string"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"getEvidenceInfo","outputs":[{"name":"","type":"address"},{"name":"","type":"uint256"},{"name":"","type":"address"},{"name":"","type":"address"},{"name":"","type":"uint256"},{"name":"","type":"uint256"},{"name":"","type":"address"},{"name":"","type":"address"},{"name":"","type":"uint256"},{"name":"","type":"uint256"},{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"amount","type":"uint256"}],"name":"EvidenceTransferConfirm","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"getSubEvidence","outputs":[{"name":"","type":"address[]"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_address","type":"address"},{"name":"amount","type":"uint256"}],"name":"EvidenceTransferVerify","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"v","type":"uint8"},{"name":"r","type":"bytes32"},{"name":"s","type":"bytes32"},{"name":"_PaidHash","type":"bytes32"}],"name":"PaidTransaction","outputs":[{"name":"","type":"bool"},{"name":"","type":"string"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"inputs":[{"name":"_evidencetype","type":"uint256"},{"name":"_debtor","type":"address"},{"name":"_due_time","type":"uint256"},{"name":"_raw_debtor","type":"address"},{"name":"_parent_evidence","type":"address"},{"name":"_initial_amount","type":"uint256"},{"name":"_Tx_hash","type":"bytes32"},{"name":"_commodity","type":"string"},{"name":"_funds","type":"uint256"},{"name":"_info","type":"string"},{"name":"_v1","type":"uint8"},{"name":"_r1","type":"bytes32"},{"name":"_s1","type":"bytes32"}],"payable":false,"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":false,"name":"_addr","type":"address"}],"name":"AcceptedEvent","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"_addr","type":"address"}],"name":"ConfirmEvent","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"_amount","type":"uint256"},{"indexed":false,"name":"_to","type":"address"}],"name":"TransferConfirmEvent","type":"event"},{"anonymous":false,"inputs":[],"name":"PaidEvent","type":"event"}],
    		"groupId" :"1"
		};
		http_post(ip, port, "/WeBASE-Front/contract/abiInfo", "", JSON.stringify(params), function(is_ok, data) {		
		});
		res.send(legal_address);
	}
	else{
		res.send(JSON.parse(data)["errorMessage"]);
	}
  });
});



router.post('/txSearch',function(req,res,next){
	if(!req.session.username){
  	res.send(301);
  }
	var params = {
    "useAes":false,
    "user":req.session.address,
    "contractName":"DebtEvidence",
    "contractAddress":req.body.address,
    "funcName":"getEvidenceInfo",
    "funcParam":[],
    "groupId" :"1"
	};
	var json_data = {"evidenceAddress":req.session.address};
	http_post(ip, port, "/WeBASE-Front/trans/handle", "", JSON.stringify(params), function(is_ok, data) {
		console.log(data);
	if (is_ok) {
	 	json = JSON.parse(data);
	 	json_data["owner"]= json[0];
	 	json_data["evidencetype"]= json[1];
	 	json_data["debtor"]= json[2];
	 	json_data["creditor"]= json[3];
	 	json_data["signed_time"]= json[4];
	 	json_data["due_time"]= json[5];
	 	json_data["raw_debtor"]= json[6];
	 	json_data["parent_evidence"]= json[7];
	 	json_data["initial_amount"]= json[8];
	 	json_data["current_amount"]= json[9];
	 	json_data["state"]= json[10];
	 	params["funcName"] = "getPaymentInfo";
	 	http_post(ip, port, "/WeBASE-Front/trans/handle", "", JSON.stringify(params), function(is_ok, data) {
			if (is_ok) {
	 		json = JSON.parse(data); 
	 		json_data["isDebtorPaid"]= json[0];
	 		json_data["PaidHash"]= json[1];
	 		json_data["pay_v1"]= json[2];
	 		json_data["pay_r1"]= json[3];
	 		json_data["pay_s1"]= json[4];
	 		json_data["pay_v2"]= json[5];
	 		json_data["pay_r2"]= json[6];
	 		json_data["pay_s2"]= json[7];
	 		params["funcName"] = "getSignature";
	 		http_post(ip, port, "/WeBASE-Front/trans/handle", "", JSON.stringify(params), function(is_ok, data) {
				if (is_ok) {
	 				json = JSON.parse(data);
	 				json_data["v1"]= json[1];
	 				json_data["r1"]= json[2];
	 				json_data["s1"]= json[3];
	 				json_data["v2"]= json[5];
	 				json_data["r2"]= json[6];
	 				json_data["s2"]= json[7];
	 				json_data["certifier"]= json[8];
	 				json_data["v3"]= json[9];
	 				json_data["r3"]= json[10];
	 				json_data["s3"]= json[11];
	 				params["funcName"] = "getSubEvidence";
	 				http_post(ip, port, "/WeBASE-Front/trans/handle", "", JSON.stringify(params), function(is_ok, data) {
					if (is_ok) {
	 					json = JSON.parse(data);
	 					json_data["SubEvidence"] = json;
	 					params["funcName"] = "getTxInfo";
	 					http_post(ip, port, "/WeBASE-Front/trans/handle", "", JSON.stringify(params), function(is_ok, data) {
							if (is_ok) {
	 							json = JSON.parse(data);
	 							json_data["Tx_hash"]= json[0];
	 							json_data["commodity"]= json[1];
	 							json_data["funds"]= json[2];
	 							json_data["info"]= json[3];
	 							console.log(JSON.stringify(json_data));
	 							res.json(json_data);
							}
						});
						}else{
							res.send(404);
						}
					});
				}else{
					res.send(404);
				}
			});
			}else{
				res.send(404);
			}
		});
	}else{
		res.send(404);
	}
	});
});

router.post('/txPay',function(req,res,next){
	if(!req.session.username){
  	res.send(301);
  }
	var params = {
    "useAes":false,
    "user":req.session.address,
    "contractName":"DebtEvidence",
    "contractAddress":req.body.address,
    "funcName":"PaidTransaction",
    "funcParam":[3,"0x6","0x3",req.body.payhash],
    "groupId" :"1"
	};
	http_post(ip, port, "/WeBASE-Front/trans/handle", "", JSON.stringify(params), function(is_ok, data) {
	if (is_ok) {
	 	console.log(data.toString());
	 	if(JSON.parse(data)["logs"] == null || JSON.parse(data)["logs"].length==0){
	 		res.sendStatus(500);
	 	}else{
	 	res.send(data["logs"]);
	 	}
	}
	else{
		res.sendStatus(500);
		return;
	}
	});
});

router.post('/txSign',function(req,res,next){
	if(!req.session.username){
  	res.send(301);
  }
	var params = {
    "useAes":false,
    "user":req.session.address,
    "contractName":"DebtEvidence",
    "contractAddress":req.body.address,
    "funcName":"AcceptTransaction",
    "funcParam":[req.session.username,2,"0x1","0x1"],
    "groupId" :"1"
	};
	if(req.body.accept == 'false') params["funcName"]= "ConfirmTransaction";
	http_post(ip, port, "/WeBASE-Front/trans/handle", "", JSON.stringify(params), function(is_ok, data) {
	if (is_ok) {
	 	console.log(data.toString());
	 	if(JSON.parse(data)["logs"] == null || JSON.parse(data)["logs"].length==0){
	 		res.sendStatus(500);
	 	}else{
	 	res.send(data["logs"]);
	 	}
	}
	else{
		res.sendStatus(500);
		return;
	}
	});
});

router.post('/txTrans',function(req,res,next){
	if(!req.session.username){
  	res.send(301);
  	}
	funcParam = [req.session.username,req.body.address,req.body.txhash,+req.body.amount,"",0,req.body.info,1,"0x1","0x1"];
	if(req.body.fundtype==true){
		funcParam[5]=req.body.item;
	}else{
		funcParam[4]=req.body.item;
	}
	console.log(funcParam);
	var params = {
    "useAes":false,
    "user":req.session.address,
    "contractName":"SupplyChain",
    "contractAddress":supplychain_address,
    "funcName":"EvidenceTransfer",
    "funcParam":funcParam,
    "groupId" :"1"
	};
	http_post(ip, port, "/WeBASE-Front/trans/handle", "", JSON.stringify(params), function(is_ok, data) {
	console.log(data.toString());
	if (is_ok) {
	 	if(JSON.parse(data)["logs"] == null || JSON.parse(data)["logs"].length==0){
	 		res.sendStatus(500);
	 		return;
	 	}
	 	address = JSON.parse(data)["output"];
		//去除前导0
		var legal_address;
		legal_address = address.substr(0,2)+address.substr(address.length-40,40);
		params = {
    		"contractBin":'60806040523480156200001157600080fd5b5060405162002a0c38038062002a0c83398101806040528101908080519060200190929190805190602001909291908051906020019092919080519060200190929190805190602001909291908051906020019092919080519060200190929190805182019291906020018051906020019092919080518201929190602001805190602001909291908051906020019092919080519060200190929190505050336000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508c6002811115620000fe57fe5b600060146101000a81548160ff021916908360028111156200011c57fe5b02179055508b600160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550426003819055508a60048190555089600560006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555088600660006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555087600881905550876009819055506000600a60006101000a81548160ff021916908360038111156200022057fe5b021790555086600b816000191690555085600c908051906020019062000248929190620002c8565b5084600d8190555083600e908051906020019062000268929190620002c8565b5082600f60146101000a81548160ff021916908360ff160217905550816010816000191690555080601181600019169055506000601860006101000a81548160ff0219169083151502179055505050505050505050505050505062000377565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106200030b57805160ff19168380011785556200033c565b828001600101855582156200033c579182015b828111156200033b5782518255916020019190600101906200031e565b5b5090506200034b91906200034f565b5090565b6200037491905b808211156200037057600081600090555060010162000356565b5090565b90565b61268580620003876000396000f3006080604052600436106100d0576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff16806304da3f19146100d557806317bd3ed6146101695780635e878508146101945780636d01875d146102d95780637e78fdb9146103045780638a4e37691461035b5780639c14c09514610499578063c1a0b0fc146105af578063c6bf57651461060a578063c7eaf9b414610720578063dfbfd9151461086d578063e857fa6c146108b2578063f5055e061461091e578063f5434eed14610983575b600080fd5b3480156100e157600080fd5b506100ea610a61565b604051808915151515815260200188600019166000191681526020018760ff1660ff168152602001866000191660001916815260200185600019166000191681526020018460ff1660ff168152602001836000191660001916815260200182600019166000191681526020019850505050505050505060405180910390f35b34801561017557600080fd5b5061017e610ac6565b6040518082815260200191505060405180910390f35b3480156101a057600080fd5b506101a9610ad0565b60405180866000191660001916815260200180602001858152602001806020018473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001838103835287818151815260200191508051906020019080838360005b83811015610233578082015181840152602081019050610218565b50505050905090810190601f1680156102605780820380516001836020036101000a031916815260200191505b50838103825285818151815260200191508051906020019080838360005b8381101561029957808201518184015260208101905061027e565b50505050905090810190601f1680156102c65780820380516001836020036101000a031916815260200191505b5097505050505050505060405180910390f35b3480156102e557600080fd5b506102ee610c50565b6040518082815260200191505060405180910390f35b34801561031057600080fd5b50610319610c5a565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b34801561036757600080fd5b50610370610c84565b604051808d73ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018c60ff1660ff1681526020018b600019166000191681526020018a600019166000191681526020018973ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018860ff1660ff168152602001876000191660001916815260200186600019166000191681526020018573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018460ff1660ff168152602001836000191660001916815260200182600019166000191681526020019c5050505050505050505050505060405180910390f35b3480156104a557600080fd5b50610529600480360381019080803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509192919290803560ff16906020019092919080356000191690602001909291908035600019169060200190929190505050610d67565b604051808315151515815260200180602001828103825283818151815260200191508051906020019080838360005b83811015610573578082015181840152602081019050610558565b50505050905090810190601f1680156105a05780820380516001836020036101000a031916815260200191505b50935050505060405180910390f35b3480156105bb57600080fd5b506105f0600480360381019080803573ffffffffffffffffffffffffffffffffffffffff1690602001909291905050506111a0565b604051808215151515815260200191505060405180910390f35b34801561061657600080fd5b5061069a600480360381019080803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509192919290803560ff16906020019092919080356000191690602001909291908035600019169060200190929190505050611271565b604051808315151515815260200180602001828103825283818151815260200191508051906020019080838360005b838110156106e45780820151818401526020810190506106c9565b50505050905090810190601f1680156107115780820380516001836020036101000a031916815260200191505b50935050505060405180910390f35b34801561072c57600080fd5b5061073561147b565b604051808c73ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018b81526020018a73ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018973ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018881526020018781526020018673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018481526020018381526020018281526020019b50505050505050505050505060405180910390f35b34801561087957600080fd5b506108986004803603810190808035906020019092919050505061159f565b604051808215151515815260200191505060405180910390f35b3480156108be57600080fd5b506108c76116d0565b6040518080602001828103825283818151815260200191508051906020019060200280838360005b8381101561090a5780820151818401526020810190506108ef565b505050509050019250505060405180910390f35b34801561092a57600080fd5b50610969600480360381019080803573ffffffffffffffffffffffffffffffffffffffff1690602001909291908035906020019092919050505061175e565b604051808215151515815260200191505060405180910390f35b34801561098f57600080fd5b506109db600480360381019080803560ff16906020019092919080356000191690602001909291908035600019169060200190929190803560001916906020019092919050505061188a565b604051808315151515815260200180602001828103825283818151815260200191508051906020019080838360005b83811015610a25578082015181840152602081019050610a0a565b50505050905090810190601f168015610a525780820380516001836020036101000a031916815260200191505b50935050505060405180910390f35b600080600080600080600080601860009054906101000a900460ff16601954601a60009054906101000a900460ff16601b54601c54601d60009054906101000a900460ff16601e54601f54975097509750975097509750975097509091929394959697565b6000600454905090565b60006060600060606000600b54600c600d54600e600f60009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16838054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015610b9c5780601f10610b7157610100808354040283529160200191610b9c565b820191906000526020600020905b815481529060010190602001808311610b7f57829003601f168201915b50505050509350818054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015610c385780601f10610c0d57610100808354040283529160200191610c38565b820191906000526020600020905b815481529060010190602001808311610c1b57829003601f168201915b50505050509150945094509450945094509091929394565b6000600954905090565b6000600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16905090565b600080600080600080600080600080600080600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16600f60149054906101000a900460ff16601054601154600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16601260009054906101000a900460ff16601354601454600f60009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16601560009054906101000a900460ff166016546017549b509b509b509b509b509b509b509b509b509b509b509b50909192939495969798999a9b565b6000606060001515610d798733611cb3565b15151415610dc25760006040805190810160405280600e81526020017f696c6c6567616c2061636365737300000000000000000000000000000000000081525091509150611197565b600380811115610dce57fe5b610dd7876121ff565b6003811115610de257fe5b6003811115610ded57fe5b141515610e355760006040805190810160405280601881526020017f6e6f742063657274696679696e6720617574686f72697479000000000000000081525091509150611197565b60006003811115610e4257fe5b600a60009054906101000a900460ff166003811115610e5d57fe5b1415610ea45760006040805190810160405280601881526020017f7472616e73616374696f6e206e6f74206163637065746564000000000000000081525091509150611197565b60016003811115610eb157fe5b600a60009054906101000a900460ff166003811115610ecc57fe5b141515610f145760006040805190810160405280602081526020017f7472616e73616374696f6e20697320616c726561647920636f6e6669726d656481525091509150611197565b33600f60006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555084601560006101000a81548160ff021916908360ff160217905550836016816000191690555082601781600019169055506002600a60006101000a81548160ff02191690836003811115610fa557fe5b021790555060016002811115610fb757fe5b600060149054906101000a900460ff166002811115610fd257fe5b14801561101857506000600660009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1614155b156110f757600660009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663dfbfd9156009546040518263ffffffff167c010000000000000000000000000000000000000000000000000000000002815260040180828152602001915050602060405180830381600087803b1580156110b057600080fd5b505af11580156110c4573d6000803e3d6000fd5b505050506040513d60208110156110da57600080fd5b810190808051906020019092919050505015156110f657600080fd5b5b7f71dc038f05603e1a224e16013aa1eee13aaac7365b1430820e4648c833aa33d133604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390a160016040805190810160405280601581526020017f7472616e73616374696f6e20636f6e6669726d65640000000000000000000000815250915091505b94509492505050565b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16141515611201576000905061126c565b60078290806001815401808255809150509060018203906000526020600020016000909192909190916101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555050600190505b919050565b60006060600015156112838733611cb3565b151514156112cc5760006040805190810160405280600e81526020017f696c6c6567616c2061636365737300000000000000000000000000000000000081525091509150611472565b600060038111156112d957fe5b600a60009054906101000a900460ff1660038111156112f457fe5b14151561133c5760006040805190810160405280601d81526020017f7472616e73616374696f6e20686173206265656e20616363706574656400000081525091509150611472565b33600260006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555084601260006101000a81548160ff021916908360ff160217905550836013816000191690555082601481600019169055506001600a60006101000a81548160ff021916908360038111156113cd57fe5b02179055507f3046a5cb3c999f24e9da92265b1aa10e877e91dfacc1ad40b142e9ecf3e4de8e33604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390a160016040805190810160405280601481526020017f7472616e73616374696f6e206163636570746564000000000000000000000000815250915091505b94509492505050565b60008060008060008060008060008060008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16600060149054906101000a900460ff1660028111156114c957fe5b600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16600354600454600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16600660009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16600854600954600a60009054906101000a900460ff16600381111561157c57fe5b9a509a509a509a509a509a509a509a509a509a509a50909192939495969798999a565b600080600090505b6007805490508110156116c5573373ffffffffffffffffffffffffffffffffffffffff166007828154811015156115da57fe5b9060005260206000200160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1614156116b85782600954101561163457600091506116ca565b826009600082825403925050819055507f64cea6b2311dae2ee8a78ce0dd270260dd650a1ac7eed0ced28722625ec424f78333604051808381526020018273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019250505060405180910390a1600191506116ca565b80806001019150506115a7565b600091505b50919050565b6060600780548060200260200160405190810160405280929190818152602001828054801561175457602002820191906000526020600020905b8160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001906001019080831161170a575b5050505050905090565b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161415156117bf5760009050611884565b600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff1614151561181f5760009050611884565b6002600381111561182c57fe5b600a60009054906101000a900460ff16600381111561184757fe5b1415156118575760009050611884565b6000600d5414151561186c5760009050611884565b60095482111561187f5760009050611884565b600190505b92915050565b6000606060038081111561189a57fe5b600a60009054906101000a900460ff1660038111156118b557fe5b1415611923576000606060405190810160405280602181526020017f7472616e73616374696f6e2068617320616c7265616479206265656e2070616981526020017f640000000000000000000000000000000000000000000000000000000000000081525091509150611caa565b6002600381111561193057fe5b600a60009054906101000a900460ff16600381111561194b57fe5b1415156119ba576000606060405190810160405280602281526020017f7472616e73616374696f6e20686173206e6f74206265656e20636f6e6669726d81526020017f656400000000000000000000000000000000000000000000000000000000000081525091509150611caa565b600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161415611afe57601860009054906101000a900460ff1615611a665760006040805190810160405280600c81526020017f616c72656164792070616964000000000000000000000000000000000000000081525091509150611caa565b6001601860006101000a81548160ff02191690831515021790555085601a60006101000a81548160ff021916908360ff16021790555084601b816000191690555083601c8160001916905550826019816000191690555060016040805190810160405280601481526020017f7761697420746f20626520636f6e6669726d656400000000000000000000000081525091509150611caa565b600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161415611c6d57601860009054906101000a900460ff161515611bab5760006040805190810160405280601481526020017f646562746f7220686173206e6f7420706169642e00000000000000000000000081525091509150611caa565b85601d60006101000a81548160ff021916908360ff16021790555084601e816000191690555083601f81600019169055506003600a60006101000a81548160ff02191690836003811115611bfb57fe5b02179055507feff32cd8ccb03fd86051fe0cc2d91fe87eb44db13680778658a04f502d63e69460405160405180910390a160016040805190810160405280601a81526020017f7472616e73616374696f6e207061696420636f6e6669726d656400000000000081525091509150611caa565b60006040805190810160405280600e81526020017f696c6c6567616c20616363657373000000000000000000000000000000000000815250915091505b94509492505050565b60008060008061100192508273ffffffffffffffffffffffffffffffffffffffff1663f23f63c96040518163ffffffff167c01000000000000000000000000000000000000000000000000000000000281526004018080602001828103825260048152602001807f5573657200000000000000000000000000000000000000000000000000000000815250602001915050602060405180830381600087803b158015611d5e57600080fd5b505af1158015611d72573d6000803e3d6000fd5b505050506040513d6020811015611d8857600080fd5b810190808051906020019092919050505091508173ffffffffffffffffffffffffffffffffffffffff1663e8434e39878473ffffffffffffffffffffffffffffffffffffffff16637857d7c96040518163ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401602060405180830381600087803b158015611e1c57600080fd5b505af1158015611e30573d6000803e3d6000fd5b505050506040513d6020811015611e4657600080fd5b81019080805190602001909291905050506040518363ffffffff167c010000000000000000000000000000000000000000000000000000000002815260040180806020018373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001828103825284818151815260200191508051906020019080838360005b83811015611ef4578082015181840152602081019050611ed9565b50505050905090810190601f168015611f215780820380516001836020036101000a031916815260200191505b509350505050602060405180830381600087803b158015611f4157600080fd5b505af1158015611f55573d6000803e3d6000fd5b505050506040513d6020811015611f6b57600080fd5b8101908080519060200190929190505050905060018173ffffffffffffffffffffffffffffffffffffffff1663949d225d6040518163ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401602060405180830381600087803b158015611fe457600080fd5b505af1158015611ff8573d6000803e3d6000fd5b505050506040513d602081101561200e57600080fd5b810190808051906020019092919050505014151561202f57600093506121f6565b8473ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff1663846719e060006040518263ffffffff167c010000000000000000000000000000000000000000000000000000000002815260040180828152602001915050602060405180830381600087803b1580156120b657600080fd5b505af11580156120ca573d6000803e3d6000fd5b505050506040513d60208110156120e057600080fd5b810190808051906020019092919050505073ffffffffffffffffffffffffffffffffffffffff1663bf40fac16040518163ffffffff167c01000000000000000000000000000000000000000000000000000000000281526004018080602001828103825260078152602001807f6164647265737300000000000000000000000000000000000000000000000000815250602001915050602060405180830381600087803b15801561219057600080fd5b505af11580156121a4573d6000803e3d6000fd5b505050506040513d60208110156121ba57600080fd5b810190808051906020019092919050505073ffffffffffffffffffffffffffffffffffffffff161415156121f157600093506121f6565b600193505b50505092915050565b60008060008061100192508273ffffffffffffffffffffffffffffffffffffffff1663f23f63c96040518163ffffffff167c01000000000000000000000000000000000000000000000000000000000281526004018080602001828103825260048152602001807f5573657200000000000000000000000000000000000000000000000000000000815250602001915050602060405180830381600087803b1580156122aa57600080fd5b505af11580156122be573d6000803e3d6000fd5b505050506040513d60208110156122d457600080fd5b810190808051906020019092919050505091508173ffffffffffffffffffffffffffffffffffffffff1663e8434e39868473ffffffffffffffffffffffffffffffffffffffff16637857d7c96040518163ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401602060405180830381600087803b15801561236857600080fd5b505af115801561237c573d6000803e3d6000fd5b505050506040513d602081101561239257600080fd5b81019080805190602001909291905050506040518363ffffffff167c010000000000000000000000000000000000000000000000000000000002815260040180806020018373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001828103825284818151815260200191508051906020019080838360005b83811015612440578082015181840152602081019050612425565b50505050905090810190601f16801561246d5780820380516001836020036101000a031916815260200191505b509350505050602060405180830381600087803b15801561248d57600080fd5b505af11580156124a1573d6000803e3d6000fd5b505050506040513d60208110156124b757600080fd5b810190808051906020019092919050505090508073ffffffffffffffffffffffffffffffffffffffff1663846719e060006040518263ffffffff167c010000000000000000000000000000000000000000000000000000000002815260040180828152602001915050602060405180830381600087803b15801561253a57600080fd5b505af115801561254e573d6000803e3d6000fd5b505050506040513d602081101561256457600080fd5b810190808051906020019092919050505073ffffffffffffffffffffffffffffffffffffffff1663fda69fae6040518163ffffffff167c01000000000000000000000000000000000000000000000000000000000281526004018080602001828103825260098152602001807f757365725f747970650000000000000000000000000000000000000000000000815250602001915050602060405180830381600087803b15801561261457600080fd5b505af1158015612628573d6000803e3d6000fd5b505050506040513d602081101561263e57600080fd5b810190808051906020019092919050505093505050509190505600a165627a7a7230582023ec213c4305ca8680d10d0fc919261192607a0db337c80f40e63f6371fd6ca40029',
    		"contractName":"DebtEvidence",
    		"address":legal_address,
    		"abiInfo":[{"constant":true,"inputs":[],"name":"getPaymentInfo","outputs":[{"name":"","type":"bool"},{"name":"","type":"bytes32"},{"name":"","type":"uint8"},{"name":"","type":"bytes32"},{"name":"","type":"bytes32"},{"name":"","type":"uint8"},{"name":"","type":"bytes32"},{"name":"","type":"bytes32"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"getDueTime","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"getTxInfo","outputs":[{"name":"","type":"bytes32"},{"name":"","type":"string"},{"name":"","type":"uint256"},{"name":"","type":"string"},{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"getDebtAmount","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"getDebtor","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"getSignature","outputs":[{"name":"","type":"address"},{"name":"","type":"uint8"},{"name":"","type":"bytes32"},{"name":"","type":"bytes32"},{"name":"","type":"address"},{"name":"","type":"uint8"},{"name":"","type":"bytes32"},{"name":"","type":"bytes32"},{"name":"","type":"address"},{"name":"","type":"uint8"},{"name":"","type":"bytes32"},{"name":"","type":"bytes32"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"account","type":"string"},{"name":"_v3","type":"uint8"},{"name":"_r3","type":"bytes32"},{"name":"_s3","type":"bytes32"}],"name":"ConfirmTransaction","outputs":[{"name":"","type":"bool"},{"name":"","type":"string"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_address","type":"address"}],"name":"AddSubEvidence","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"account","type":"string"},{"name":"_v2","type":"uint8"},{"name":"_r2","type":"bytes32"},{"name":"_s2","type":"bytes32"}],"name":"AcceptTransaction","outputs":[{"name":"","type":"bool"},{"name":"","type":"string"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"getEvidenceInfo","outputs":[{"name":"","type":"address"},{"name":"","type":"uint256"},{"name":"","type":"address"},{"name":"","type":"address"},{"name":"","type":"uint256"},{"name":"","type":"uint256"},{"name":"","type":"address"},{"name":"","type":"address"},{"name":"","type":"uint256"},{"name":"","type":"uint256"},{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"amount","type":"uint256"}],"name":"EvidenceTransferConfirm","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"getSubEvidence","outputs":[{"name":"","type":"address[]"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_address","type":"address"},{"name":"amount","type":"uint256"}],"name":"EvidenceTransferVerify","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"v","type":"uint8"},{"name":"r","type":"bytes32"},{"name":"s","type":"bytes32"},{"name":"_PaidHash","type":"bytes32"}],"name":"PaidTransaction","outputs":[{"name":"","type":"bool"},{"name":"","type":"string"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"inputs":[{"name":"_evidencetype","type":"uint256"},{"name":"_debtor","type":"address"},{"name":"_due_time","type":"uint256"},{"name":"_raw_debtor","type":"address"},{"name":"_parent_evidence","type":"address"},{"name":"_initial_amount","type":"uint256"},{"name":"_Tx_hash","type":"bytes32"},{"name":"_commodity","type":"string"},{"name":"_funds","type":"uint256"},{"name":"_info","type":"string"},{"name":"_v1","type":"uint8"},{"name":"_r1","type":"bytes32"},{"name":"_s1","type":"bytes32"}],"payable":false,"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":false,"name":"_addr","type":"address"}],"name":"AcceptedEvent","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"_addr","type":"address"}],"name":"ConfirmEvent","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"_amount","type":"uint256"},{"indexed":false,"name":"_to","type":"address"}],"name":"TransferConfirmEvent","type":"event"},{"anonymous":false,"inputs":[],"name":"PaidEvent","type":"event"}],
    		"groupId" :"1"
		};
		http_post(ip, port, "/WeBASE-Front/contract/abiInfo", "", JSON.stringify(params), function(is_ok, data) {		
		});
		res.send(legal_address);
	}
	else{
		res.sendStatus(500);
	}
	});
});

module.exports = router;
